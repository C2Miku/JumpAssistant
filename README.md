# JumpAssistant
微信跳一跳游戏辅助程序
 
## 简介
 
此程序使用ADB与手机进行交互（包括截图、模拟触摸），然后程序将获取到的截图进行简单的图像处理，分析出小人当前所在的位置坐标和下一个方块的中心点坐标。算法和思路较为简单，有时会出现少许误差，在几次跳跃的调整后，误差会慢慢减小。该程序不算复杂，适合初学者一起学习。由于存在误差，到后面方块面积越来越小，很有可能就撑不住了。不过不用担心，突破1000分不成问题，当然我也并不知道最高能跳到多少（在程序写完后的几次试跳里，最高分2308）——又是鉴定是非是欧的时间了！运气好的话说不定也能直接破万呢……
 
## 使用方法
 
**请先安装Java运行环境和喜欢的IDE，以及ADB(Android Debug Bridge)。我使用的IDE是IntelliJ IDEA CE 2017，运行环境macOS 10.13.2。**
1. 将手机连接到电脑（仅限Android手机），打开USB调试，允许此台电脑进行调试；
2. 导入项目（核心文件：```JumpAssitant/src/JumpAssistant.java```，需要的两个类文件在此文件夹下的```Coordinate.java```和```RGB.java```，out文件夹下的为编译文件）；
3. 根据自己的情况修改以下常量：
```
ADB_ROUTE        //ADB的所在路径
TEMP_ROUTE       //存储临时截图文件的路径
SCREEN_HEIGHT    //屏幕分辨率高度
SCREEN_WIDTH     //屏幕分辨率宽度
RATIO            //距离与按压时间的系数，不同的分辨率或DPI可能需要尝试着更改
COLOR_DIFF_MAX   //紫色小人的底部左右边缘的颜色允许差值，可能会因为分辨率的不同导致渲染的颜色不同
```
4. 运行```JumpAssistant.main()```。
 
## 实现思路
 
1. 依赖```java.awt.image.BufferedImage```包，读取图片数据并对其进行分析；
2. 主要使用的ADB命令：
```
adb devices            //获取连接的Android设备列表
adb shell screencap    //对手机屏幕进行截图
adb pull               //将手机里的文件（截图）推送到计算机
adb shell rm           //删除手机里的文件（截图）释放空间
adb shell input swipe  //模拟滑动（可以实现模拟长按指定时间的效果）
```
3. 为方便程序中使用和表达清楚，新建了一个平面坐标对象```Coordinate```、一个RGB颜色对象```RGB```以避免出现看起来比较费劲的数组；
4. 比较两个颜色的差值：在方法```GetColorDiff()```中。将两个颜色的RGB值分别作差求绝对值并相加；
5. 获取紫色小人的坐标：在方法```GetPlayerPosition()```中。在1080P的设备上取到的小人底部左右两侧的颜色为(43,43,73)(60,56,83)，分辨率不同的设备可能会导致渲染出的颜色不同，可以适当修改```COLOR_DIFF_MAX```来允许颜色误差。扫描时按行从左向右从下向上扫描。然后将获得的底部左右两端坐标取平均，即是小人当前的坐标；
6. 获取下一个方块的坐标：在方法```GetNextBlockPosition()```中。注意，此步算法存在一定误差。思路很简单，直接找方块的最高边缘的坐标，扫描时按行从上向下从左向右或从右向左（根据小人坐标处于屏幕左侧还是右侧决定）扫描。关于背景颜色，每行的像素颜色是相同的，但是有少许像素的颜色有极小的颜色差，所以用```GetColorDiff()```来允许差值——通常方块的颜色和背景颜色的差值很大，所以不用担心。游戏的方块的上表面基本上都是正方形和圆形，而每个方块的中心点的连线的斜率都是±k(k为常数0.5733)，从而用数学方法很容易得到下一个方块的中心点。游戏中仅有一种方块的上表面为长方形，这就是最容易引起误差的情况。注释：```edgeContinuousLen```变量记录最高处边缘的持续长度，从而取最高处边缘的中点，减小误差；
7. 根据```RATIO```值计算出长按时间，通过ADB对手机进行模拟操作。

## 关于“可疑操作”

游戏采取了未知的防作弊操作，有可能会出现提示“游戏中存在可疑操作，该分数将不在排行榜中显示”。为了解决这个问题，程序中将每两次跳跃之间的时间间隔和触屏坐标都设置为随机。但是过高的分数也会被认为是可疑操作。总之防作弊的机制并不明确，想刷分就一步一步慢慢来，心急吃不了热豆腐。


## 写在最后

此程序的旨意在于互相借鉴和学习，然后必不可少的就是刷刷分装装逼啦。作为开源项目，我不希望有人会拿去用作商业用途（写的很不咋地的代码还想被人拿去赚钱？赚都赚不到吧）。另外鉴于时间问题，就没写图形界面，有什么问题，也欢迎大家在讨论区留言。萌新的第一个项目，望支持！
